\section{Theory}
\label{sec:theory}

\subsection{Mathematical modeling}
The theory behind the mathematical modeling is very much based upon the modeling described in Section 3 in the paper by \cite{Current}. The basic idea of a current-reinforced random walk is to find the shortest path through a given graph. The core of this modeling is that there are sources, sinks, nodes, particles and edges all organized within a graph representing a network. The fundamental idea is that sources send out information, sinks want information and particles represent information. Edges are connections between sources, sinks and nodes and represent a path for the information to spread. Sources have a production rate, i.e the rate at which new particles are being injected int the system. Sinks have a removal rate, i.e. the rate at which particles are being removed from the system. Sources, sinks and nodes can all contain particles. For a system to have a viable solution for a shortest path between sources and sinks the cumulative production rate of all the sources  must be less or equal to the cumulative removal rate of all the sinks, otherwise no flow equilibrium can be established.

There are several analogies in nature to this modeling. For example can the transport network of many pheromone dropping ants be modeled by current-reinforced random walks as presented in \cite{Schweitzer1997153}. When the ants move around in their search for food or building material they drop pheromone in certain patterns. If an ant has found food it drops an amount of pheromone which other ants then can register. Ants want to move along paths where other ants are moving, and are more likely to do so if there is a high pheromone concentration. This causes the ants to create current-reinforced patterns through their transport network.

An other example is how the current and conductivity changes in special electrical networks as presented in \cite{Doyle}. Here the conductivity changes with the current. This causes electrons to more easily flow where there already is a current present, leading to shortest path patterns through the electrical network. 

There are some necessary parameters for this model to make sens. These parameters and their analogy in both electrical networks and ant trail network are shown in Table \ref{tab:parameters}.
\begin{table}
\centering
\caption{Table shows the necessary parameters for the current-reinforced random walk modeling and their analogy in electrical networks and ant trail network. $i$ denotes that the parameter corresponds to node $i$ and $ij$ denotes that the parametar corresponds to the edge between node $i$ en node $j$.}
\label{tab:parameters}
\begin{tabular}{ c | c | c }                       
	\textbf{Parameter} & \textbf{Electrical network} & \textbf{Ant trails} \\
	\hline
	$l_{ij}$ & length in space & length in space \\
	\hline
	$N_{i}$ & potential & number of ants \\
	\hline
	$I_{ij}$ & current & flow of ants \\
	\hline
	$D_{ij}$ & conductivity & pheromone concentration \\
	\hline
	$C_{i}$ & capacitance & total pheromone density \\
	\hline
	$q$ & reinforcement intensity & pheromone drop rate \\
	\hline
	$\lambda$ & conductivity decrease rate & pheromone evaporation rate \\
\end{tabular} 
\end{table}

The probability for a particle to move to an other node in this particular current-reinforced random walk for this paper depends on the flow of particles to that node, i.e. the current of particles. This optimizes the path length for each individual path from the sources to the sinks, i.e it minimizes the cost function

\begin{equation}
\sum_{j \in \text{Neighbors}(i)} l_{ij} \bar{I}_{ij},
\end{equation}

\noindent where $l_{ij}$ is the edge length between node $i$ and $j$ and $\bar{I}_{ij}$ is the corresponding mean flow of particles. When utilizing non linear current-reinforced random walks a combination of path length and path maintenance is optimized. I this case the algorithm minimizes something like

\begin{equation}
\sum_{j \in \text{Neighbors}(i)}\frac{l_{ij}}{D_{ij}}\bar{I}^{1/\mu},
\end{equation}

\noindent where $\mu$ is the path maintenance parameter. 

Non linear current-reinforced random walks describe many networks created by animals. Ants for example may want to construct one big road for transporting food rather than many small ones to easier keep needles and dirt of the road while not making each individual path that much longer.


\subsubsection{Preparation}
The preparation begins with each node calculating the mean flow to each of its neighbors as
\begin{equation}
\bar{I}_{ij} = \frac{(N_i - N_j)D_{ij}}{l_{ij}},
\end{equation}
from which it can be seen that the mean flow depends on the conductivity of each edge, $D_{ij}$, which is initialized and kept at or above some minimal value.
The actual flow can along the edge $ij$ then be found as
\begin{equation}
I_{ij} = \text{Poi}(|\bar{I}_{ij}|\Delta t).
\end{equation}
In terms of implementation, it is important that nodes that are connected to the same edge agree on the same number of particles to transfer. This is ensured by allowing only the node with a larger number of particles to randomize the value and then both nodes use that value when updating the number of particles. This work is done at the node with the largest number of particles, since it is also important to ensure that there are never fewer than zero particles at a node and the number of particles will be decreasing at the node with the largest number of particles. When a node has a smaller number of particles than a given neighbor, the node always calculates the flow to that neighbor as zero. After all nodes have calculated and stored $\bar{I}$ and $I$, the preparation step is finished.

\subsubsection{Confirmation}
At the beginning of the confirmation part, all the data regarding how many particles will move along each edge is available. And so each node begins by updating the number of particles that is has as
 \begin{equation}
 N_i(t + \Delta t) = N_i(t) + \sum_{j \in \text{Neighbors}(i)} \left( I_{ji} - I_{ij} \right)
 \end{equation}
 The flow should theoretically be symmetric, but since only one particle has randomized a value, and the other has set it to zero, the flow is not symmetric in this implementation.
 
 \ \\
 
\noindent After that, the final part of the step begins, in which several parameters that are relevant to the algorithm are updated. First is the conductivity, which can be calculated as
\begin{equation}
D_{ij}(t + \Delta t) = D_{ij}(t) + q|\bar{I}|^\mu - \lambda D_{ij}(t)\Delta t,
\end{equation}

where $q$ is the reinforcement intensity caused by per unit flow, $\mu$ is the path maintenance parameter, $\lambda$ is the conductivity decay parameter and $\Delta t$ is the time step. If $\mu$ is set to one the current-reinforced random walk is linear and will converge to the same solution every time. If on the other hand $\mu$ is set to greater than one the current-reinforced random walk becomes non-linear and will not converge to the same solution every run. The solution path for a non linear current-reinforced random walk will instead of optimizing for shortest individual path try to minimize

\begin{equation}
\sum_{j \in \text{Neighbors}(i)}\frac{l_{ij}}{D_{ij}}\bar{I}^{1/\mu}.
\end{equation}
 

Next to be calculated is the capacitance, which is calculated as 
 \begin{equation}
 C_i = \sum_{j \in \text{Neighbors}(i)} D_{ij}
 \end{equation}
 and finally the potential is calculated as
 \begin{equation}
 P_i = \frac{N_i}{C_i}.
 \end{equation}
 
 \noindent When this is done the step is finished and the next step can be started.
 
 \subsection{Implementation and parallelism}